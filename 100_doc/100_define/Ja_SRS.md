# ソフトウェア要件定義書 (SRS)
# Tributary - Solana報酬配布システム

**更新日**: 2025-09-18
**更新者**: akameGusya

## 概要
Tributaryは、事前に任意に配布したトークンの所有量を基に任意のトークンを配布するシステムである

## 1. はじめに

### 1.1 目的
本書は、Tributaryプロジェクトにおけるプロジェクト協力者へのトークン発行と利益の自動配布を行うSolanaベースのシステムの要件を定義します。

### 1.2 適用範囲
Solanaブロックチェーンを活用したCLI特化のOSSツールとして開発し、高速かつ低コストなトランザクション処理を実現します。

### 1.3 用語定義
- **SPL**: Solana Program Library - Solanaのトークン規格
- **CLI**: Command Line Interface - コマンドライン操作
- **OSS**: Open Source Software - オープンソースソフトウェア
- **MVP**: Minimum Viable Product - 最小実用版
- **TPS**: Transactions Per Second - 1秒あたりの取引数

## 2. プロダクト概要

### 2.1 主要機能
1. 配布先ウォレットの自動収集
2. トークン保有量に基づくトークン配布
3. 設定に基づく任意トークンの自動配分
4. 全操作対応のCLIインターフェース

### 2.2 利用者分類
- **プロジェクト管理者**: 配布設定の構成・管理
- **トークン受領者**: トークンと報酬の受領

## 3. システム要件

### 3.1 機能要件

#### 3.1.1 ウォレット収集機能
- **FR-1.1**: 指定したトークンの保有者ウォレットアドレスを自動収集できること
- **FR-1.2**: 保有量の閾値を設定して対象ウォレットをフィルタリングできること
- **FR-1.3**: 収集したウォレット情報を保存・管理できること

#### 3.1.2 配布管理機能
- **FR-2.1**: トークン保有量に基づいて配布比率を計算できること
- **FR-2.2**: 任意のトークンを指定して配布できること
- **FR-2.3**: 設定に基づいて自動配布を実行できること
- **FR-2.4**: 定期配布スケジュールを設定できること
- **FR-2.5**: 配布履歴を記録・参照できること

#### 3.1.3 CLIインターフェース機能
- **FR-3.1**: `tributary init` - プロジェクト初期設定コマンド
- **FR-3.2**: `tributary collect` - ウォレット収集コマンド
- **FR-3.3**: `tributary distribute` - 手動配布実行コマンド
- **FR-3.4**: `tributary distribute auto` - 自動配布設定コマンド
- **FR-3.5**: `tributary config show` - 設定確認コマンド
- **FR-3.6**: `tributary help` - ヘルプ表示コマンド

#### 3.1.4 設定管理機能
- **FR-4.1**: ウォレット設定を安全に保存できること
- **FR-4.2**: 複数プロジェクトの設定を管理できること
- **FR-4.3**: 設定パラメータの検証ができること
- **FR-4.4**: 設定のインポート・エクスポートができること

#### 3.1.5 レポート・監視機能
- **FR-5.1**: 配布状況のレポートを生成できること
- **FR-5.2**: トランザクション履歴を確認できること
- **FR-5.3**: エラーログを記録・参照できること

### 3.2 非機能要件

#### 3.2.1 性能要件
- **NFR-1.1**: トランザクション処理時間は400ms以下であること
- **NFR-1.2**: 最大65,000 TPS（Solana性能）をサポートすること
- **NFR-1.3**: 1回の配布コストは$0.0002以下であること
- **NFR-1.4**: 1,000人への同時配布が5分以内に完了すること

#### 3.2.2 拡張性要件
- **NFR-2.1**: 1配布あたり1,000名以上の受信者を処理できること
- **NFR-2.2**: 複数プロジェクトの同時運用をサポートすること
- **NFR-2.3**: 将来的な他チェーン対応が可能な設計であること

#### 3.2.3 信頼性要件
- **NFR-3.1**: システム稼働率99.9%以上を維持すること
- **NFR-3.2**: 全トランザクションがSolanaブロックチェーンで検証可能であること
- **NFR-3.3**: 包括的なエラーハンドリング機能を提供すること
- **NFR-3.4**: 自動リトライ機能を実装すること

#### 3.2.4 セキュリティ要件
- **NFR-4.1**: 秘密鍵を業界標準の暗号化で保護すること
- **NFR-4.2**: 全トランザクションを暗号学的に署名すること
- **NFR-4.3**: 全ユーザー入力の検証を実施すること
- **NFR-4.4**: 監査ログを記録・保持すること

#### 3.2.5 使いやすさ要件
- **NFR-5.1**: CLIコマンドは標準UNIX規約に従うこと
- **NFR-5.2**: 明確なエラーメッセージとヘルプを提供すること
- **NFR-5.3**: 初期設定は5分以内で完了できること
- **NFR-5.4**: 日本語・英語の多言語対応を行うこと

## 4. システム構成

### 4.1 技術スタック
- **ブロックチェーン**: Solana
- **プログラミング言語**: TypeScript/Node.js
- **CLIフレームワーク**: Commander.js
- **Solana SDK**: @solana/web3.js, @solana/spl-token
- **設定管理**: config, dotenv
- **ログ管理**: winston
- **ビルドツール**: TypeScript, esbuild
- **パッケージング**: pkg (Binary化)

### 4.2 コアコンポーネント
1. **Wallet Collector**: ウォレットアドレス収集
2. **Distribution Engine**: 報酬計算・配布ロジック
3. **Token Service**: Solanaトークン操作
4. **CLI Interface**: コマンド処理・ユーザー対話
5. **Config Manager**: 設定・認証情報管理
6. **Report Generator**: レポート生成・履歴管理

### 4.3 外部連携
- **Solana RPC**: メインネット・テストネット・デベロップネット
- **Token Metadata**: @metaplex-foundation/js
- **Price Oracle**: CoinGecko/Jupiter API
- **フロントエンド**: REST API/GraphQL連携

## 5. 実装フェーズ

### 5.1 Phase 1: MVP (4週間)
**Week 1-2: コア機能**
- [ ] 基本CLIコマンド実装
- [ ] ウォレット収集機能
- [ ] トークン配布機能

**Week 3-4: 改善とドキュメント**
- [ ] エラーハンドリング
- [ ] ドキュメント作成
- [ ] テスト実装

### 5.2 Phase 2: OSS公開 (2-3ヶ月目)
- [ ] GitHubでの公開
- [ ] コミュニティ構築開始
- [ ] 目標: 500 stars, 10 contributors
- [ ] 最初の10ユーザー獲得

### 5.3 Phase 3: 機能拡張 (4-6ヶ月目)
- [ ] 自動配布機能
- [ ] Web UI開発
- [ ] API提供
- [ ] 他チェーン対応検討

### 5.4 Phase 4: エコシステム構築 (6-12ヶ月目)
- [ ] プラグインシステム
- [ ] 外部ツール連携
- [ ] コミュニティ主導開発
- [ ] 長期メンテナンス体制

## 6. 受入基準

### 6.1 MVP完成基準
- [ ] 全CLIコマンドがSolanaテストネットで正常動作
- [ ] トークン作成から配布まで完全なエンドツーエンドテスト完了
- [ ] 包括的ドキュメント整備完了
- [ ] 単体テストカバレッジ80%以上
- [ ] 性能要件を満たすベンチマーク完了

### 6.2 成功指標
- [ ] トランザクションコスト $0.0002以下
- [ ] 処理時間 400ms以下
- [ ] CLI設定時間 5分以下
- [ ] 重大なセキュリティ脆弱性ゼロ
- [ ] ユーザー満足度 4.0/5.0以上

### 6.3 品質基準
- [ ] コードレビュー100%実施
- [ ] 自動テスト全パス
- [ ] セキュリティ監査完了
- [ ] パフォーマンステスト完了
- [ ] ドキュメント品質確認完了

## 7. リスクと対策

### 7.1 技術リスク
| リスク | 可能性 | 影響度 | 対策 |
|--------|--------|--------|------|
| Solanaネットワーク障害 | 低 | 中 | 複数RPC対応、障害時対応 |
| 秘密鍵管理の脆弱性 | 中 | 高 | 業界標準暗号化、監査実施 |
| スケーラビリティ不足 | 低 | 中 | 分散処理設計、負荷テスト |

### 7.2 市場リスク
| リスク | 可能性 | 影響度 | 対策 |
|--------|--------|--------|------|
| 競合の追随 | 中 | 高 | 先行者優位確立、コミュニティ構築 |
| 規制変更 | 低 | 高 | 複数地域対応、法務アドバイザー |
| 採用の遅れ | 中 | 中 | OSS戦略で障壁除去 |

### 7.3 事業リスク
| リスク | 可能性 | 影響度 | 対策 |
|--------|--------|--------|------|
| 資金不足 | 低 | 高 | 段階的開発、早期収益化 |
| 人材確保困難 | 中 | 中 | リモート採用、OSS貢献者活用 |
| 市場縮小 | 低 | 中 | 他チェーン展開準備 |

## 8. 付録

### 8.1 コマンドリファレンス
```bash
# プロジェクト初期化
tributary init --name "MyProject" --network devnet

# ウォレット収集
tributary collect --token TokenAddress --threshold 100

# 手動配布
tributary distribute --token USDC --amount 10000

# 自動配布設定
tributary distribute auto --schedule weekly --token USDC

# 設定確認
tributary config show
tributary config export --output config.toml
```

### 8.2 設定ファイル形式
```toml
[project]
name = "MyProject"
token_address = "TokenAddress..."
admin_wallet = "WalletAddress..."
network = "mainnet-beta"  # devnet, testnet, mainnet-beta

[distribution]
schedule = "weekly"  # daily, weekly, monthly, custom
reward_token = "USDC"
snapshot_interval = "daily"
auto_distribute = true

[security]
encrypt_keys = true
backup_enabled = true
audit_log = true

[notification]
email = "admin@example.com"
webhook_url = "https://api.example.com/webhook"
slack_channel = "#rewards"
```

### 8.3 エラーコード一覧
| コード | 分類 | 説明 |
|--------|------|------|
| E001 | 設定 | 設定ファイルが見つからない |
| E002 | 設定 | 設定値が不正 |
| E101 | ネットワーク | RPC接続エラー |
| E102 | ネットワーク | トランザクション失敗 |
| E201 | トークン | トークン作成失敗 |
| E202 | トークン | ミント権限不足 |
| E301 | 配布 | 受信者リスト不正 |
| E302 | 配布 | 残高不足 |

