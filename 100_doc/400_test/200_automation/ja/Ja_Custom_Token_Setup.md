# ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
# Tributaryãƒ†ã‚¹ãƒˆç”¨ã®ç‹¬è‡ªSPLãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨æ–¹æ³•

**æ›´æ–°æ—¥**: 2025-09-18
**æ›´æ–°è€…**: akameGusya

## æ¦‚è¦

Solana testnetãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆã®æ·±åˆ»ãªåˆ¶é™ï¼ˆ8æ™‚é–“ã‚ãŸã‚Šæœ€å¤§5 SOLã€é »ç¹ã«åˆ©ç”¨ä¸å¯ï¼‰ã«ã‚ˆã‚Šã€ã‚«ã‚¹ã‚¿ãƒ SPLãƒˆãƒ¼ã‚¯ãƒ³ã®ä½¿ç”¨ãŒåŒ…æ‹¬çš„ãªTributaryãƒ†ã‚¹ãƒˆã®ãŸã‚ã®**æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ç‹¬è‡ªãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šã¨ä½¿ç”¨æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ¯ ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ãŒå„ªã‚Œã¦ã„ã‚‹ç†ç”±

### âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã®åˆ©ç‚¹
- **ç„¡åˆ¶é™ä¾›çµ¦**: ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªåˆ†ã ã‘ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆå¯èƒ½
- **å¸¸æ™‚åˆ©ç”¨å¯èƒ½**: ä¿¡é ¼æ€§ã®ä½ã„ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆã«ä¾å­˜ã—ãªã„
- **å®Œå…¨åˆ¶å¾¡**: ãƒˆãƒ¼ã‚¯ãƒ³é…å¸ƒã®å®Œå…¨åˆ¶å¾¡
- **ç¾å®Ÿçš„ãƒ†ã‚¹ãƒˆ**: å®Ÿéš›ã®SPLãƒˆãƒ¼ã‚¯ãƒ³æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
- **ä¸€è²«ã—ãŸçµæœ**: å†ç¾å¯èƒ½ãªãƒ†ã‚¹ãƒˆæ¡ä»¶
- **å¤–éƒ¨ä¾å­˜ãªã—**: ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆã®å¯ç”¨æ€§ã‚’å¾…ã¤å¿…è¦ãªã—

### âŒ testnet SOLã®å•é¡Œç‚¹
- **ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆåˆ¶é™**: 8æ™‚é–“ã‚ãŸã‚Šæœ€å¤§5 SOL
- **é »ç¹ãªåˆ©ç”¨ä¸å¯**: ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆãŒç©ºã¾ãŸã¯åˆ¶é™ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„
- **ãƒ†ã‚¹ãƒˆã«ä¸ååˆ†**: åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã«ã¯20+ SOLå¿…è¦
- **æ™‚é–“ãŒã‹ã‹ã‚‹**: å¿…è¦é‡ã®è“„ç©ã«æ•°æ—¥ã‹ã‹ã‚‹å¯èƒ½æ€§
- **ä¿¡é ¼æ€§ãªã—**: å¿…è¦æ™‚ã®åˆ©ç”¨å¯èƒ½æ€§ã‚’ä¿è¨¼ã§ããªã„

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®š

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±ã®æº–å‚™

ã‚«ã‚¹ã‚¿ãƒ SPLãƒˆãƒ¼ã‚¯ãƒ³ã«ã¤ã„ã¦ä»¥ä¸‹ã®æƒ…å ±ã‚’åé›†ï¼š

```json
{
  "tokenName": "YourTestToken",
  "tokenSymbol": "YTT",
  "tokenAddress": "YourTokenMintAddressHere",
  "decimals": 9,
  "totalSupply": 1000000000,
  "network": "testnet"
}
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ†ã‚¹ãƒˆè¨­å®šã®æ›´æ–°

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: ç’°å¢ƒå¤‰æ•°
```bash
# ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ†ã‚¹ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦è¨­å®š
export CUSTOM_TEST_TOKEN="YourTokenMintAddressHere"
export TEST_TOKEN_SYMBOL="YTT"
export TEST_TOKEN_DECIMALS="9"
export TEST_TOKEN_NAME="YourTestToken"
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
`custom-token-config.json`ã‚’ä½œæˆï¼š
```json
{
  "testToken": {
    "address": "YourTokenMintAddressHere",
    "symbol": "YTT",
    "name": "YourTestToken",
    "decimals": 9,
    "network": "testnet"
  },
  "testAmounts": {
    "micro": 0.1,
    "small": 1.0,
    "medium": 10.0,
    "large": 100.0
  },
  "safetyLimits": {
    "maxAmountPerTest": 1000,
    "maxRecipientsPerTest": 50
  }
}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã®æ›´æ–°

`comprehensive-test-runner.js`ã®ãƒ†ã‚¹ãƒˆè¨­å®šã‚’ä¿®æ­£ï¼š

```javascript
// comprehensive-test-runner.jså†…
constructor() {
  super();
  this.customTokenConfig = {
    useCustomToken: true,
    tokenAddress: process.env.CUSTOM_TEST_TOKEN || "YourTokenMintAddressHere",
    tokenSymbol: process.env.TEST_TOKEN_SYMBOL || "YTT",
    tokenDecimals: parseInt(process.env.TEST_TOKEN_DECIMALS) || 9,
    tokenName: process.env.TEST_TOKEN_NAME || "YourTestToken"
  };

  // ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”¨ã®å®‰å…¨åˆ¶é™ã‚’æ›´æ–°
  this.config.safetyLimits = {
    maxTotalAmount: 10000,        // ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”¨ã«å¢—åŠ 
    maxSingleAmount: 1000,        // ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”¨ã«å¢—åŠ 
    maxRecipients: 100,           // ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”¨ã«å¢—åŠ 
    minBalance: 50                // è¦ä»¶ã‚’å‰Šæ¸›
  };
}
```

## ğŸ§ª ä¿®æ­£ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### æ›´æ–°ã•ã‚ŒãŸé…å¸ƒãƒ†ã‚¹ãƒˆ

```javascript
// ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”¨ã®ä¿®æ­£ã•ã‚ŒãŸå®Ÿé…å¸ƒãƒ†ã‚¹ãƒˆ
const distributionTests = [
  { id: 'RD001', name: 'ãƒã‚¤ã‚¯ãƒ­é…å¸ƒ (1 YTT)', amount: 1, recipients: 2 },
  { id: 'RD002', name: 'å°è¦æ¨¡é…å¸ƒ (10 YTT)', amount: 10, recipients: 5 },
  { id: 'RD003', name: 'ä¸­è¦æ¨¡é…å¸ƒ (100 YTT)', amount: 100, recipients: 10 },
  { id: 'RD004', name: 'å¤§è¦æ¨¡é…å¸ƒ (1000 YTT)', amount: 1000, recipients: 20 },
  { id: 'RD005', name: 'ãƒãƒƒãƒé…å¸ƒ (500 YTT)', amount: 500, recipients: 25, batchSize: 5 }
];
```

### æ›´æ–°ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ã§ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨
tributary distribute execute \
  --amount 100 \
  --token "YourTokenMintAddressHere" \
  --network testnet \
  --wallet-file "./admin-keypair.json" \
  --batch-size 5 \
  --confirm
```

## ğŸ“Š ãƒˆãƒ¼ã‚¯ãƒ³è¦ä»¶

### ãƒ†ã‚¹ãƒˆç”¨æœ€å°ãƒˆãƒ¼ã‚¯ãƒ³ä¾›çµ¦é‡

| ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚º | å¿…è¦ãƒˆãƒ¼ã‚¯ãƒ³é‡ | ç›®çš„ |
|--------------|-------------|------|
| Phase 1 | 0ãƒˆãƒ¼ã‚¯ãƒ³ | åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿé…å¸ƒãªã—ï¼‰ |
| Phase 2 | 0ãƒˆãƒ¼ã‚¯ãƒ³ | çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ï¼‰ |
| Phase 3 | 0ãƒˆãƒ¼ã‚¯ãƒ³ | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ï¼‰ |
| Phase 4 | 0ãƒˆãƒ¼ã‚¯ãƒ³ | æœ¬ç•ªæº–å‚™ï¼ˆæ¤œè¨¼ã®ã¿ï¼‰ |
| Phase 5 | 0ãƒˆãƒ¼ã‚¯ãƒ³ | é«˜åº¦æ©Ÿèƒ½ï¼ˆä¸»ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ |
| Phase 6 | 2,000+ãƒˆãƒ¼ã‚¯ãƒ³ | å®Ÿé…å¸ƒãƒ†ã‚¹ãƒˆ |
| **åˆè¨ˆ** | **2,000+ãƒˆãƒ¼ã‚¯ãƒ³** | **å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç”¨** |

### æ¨å¥¨ãƒˆãƒ¼ã‚¯ãƒ³é…å¸ƒ

```javascript
{
  "adminWallet": 10000,      // ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆã‚¦ã‚©ãƒ¬ãƒƒãƒˆ
  "testRecipients": 5000,    // ãƒ†ã‚¹ãƒˆå—ä¿¡è€…ã®äº‹å‰è³‡é‡‘èª¿é”
  "emergencyReserve": 2000,  // äºˆæœŸã—ãªã„ãƒ†ã‚¹ãƒˆç”¨
  "totalRecommended": 17000
}
```

## ğŸ”„ çµ±åˆã‚¹ãƒ†ãƒƒãƒ—

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ›´æ–°

`setup.js`ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã«å¯¾å¿œã™ã‚‹ã‚ˆã†ä¿®æ­£ï¼š

```javascript
async setupCustomTokenEnvironment() {
  console.log('ğŸª™ ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­...');

  const tokenConfig = {
    address: process.env.CUSTOM_TEST_TOKEN,
    symbol: process.env.TEST_TOKEN_SYMBOL,
    decimals: parseInt(process.env.TEST_TOKEN_DECIMALS),
    name: process.env.TEST_TOKEN_NAME
  };

  if (!tokenConfig.address) {
    console.log('âš ï¸ ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆSOLè¨­å®šã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
    return;
  }

  console.log(`âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šæ¸ˆã¿: ${tokenConfig.name} (${tokenConfig.symbol})`);
  console.log(`ğŸ“ ãƒˆãƒ¼ã‚¯ãƒ³ã‚¢ãƒ‰ãƒ¬ã‚¹: ${tokenConfig.address}`);

  // testnetã§ãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
  await this.validateCustomToken(tokenConfig);
}
```

### ã‚¹ãƒ†ãƒƒãƒ—2: é…å¸ƒæ©Ÿèƒ½ã®æ›´æ–°

å®Ÿé…å¸ƒãƒ†ã‚¹ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨ã«ä¿®æ­£ï¼š

```javascript
async executeCustomTokenDistribution(test, recipients) {
  const tokenAddress = this.customTokenConfig.tokenAddress;
  const command = [
    'tributary distribute execute',
    `--amount ${test.amount}`,
    `--token "${tokenAddress}"`,
    `--network testnet`,
    `--wallet-file "${this.adminWalletPath}"`,
    `--recipients-file "${this.recipientFile}"`,
    test.batchSize ? `--batch-size ${test.batchSize}` : '',
    '--confirm',
    '--real-distribution'
  ].filter(Boolean).join(' ');

  console.log(`ğŸš€ ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³é…å¸ƒå®Ÿè¡Œä¸­: ${command}`);
  return await this.executeDistribution(command);
}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: å®‰å…¨æ€§æ¤œè¨¼ã®æ›´æ–°

```javascript
async validateCustomTokenBalance() {
  console.log('ğŸ’° ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³æ®‹é«˜ç¢ºèªä¸­...');

  const tokenAddress = this.customTokenConfig.tokenAddress;
  const adminWallet = this.adminWalletAddress;

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ®‹é«˜ã‚’ç¢ºèª
  const balance = await this.getTokenAccountBalance(adminWallet, tokenAddress);

  if (balance < this.config.safetyLimits.minBalance) {
    throw new Error(`ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³æ®‹é«˜ä¸è¶³: ${balance} ${this.customTokenConfig.symbol} (å¿…è¦: ${this.config.safetyLimits.minBalance})`);
  }

  console.log(`âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³æ®‹é«˜: ${balance} ${this.customTokenConfig.symbol} (ååˆ†)`);
  return balance;
}
```

## ğŸš€ å®Ÿè¡Œæ‰‹é †

### ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã§ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

1. **ç’°å¢ƒå¤‰æ•°è¨­å®š**:
```bash
export CUSTOM_TEST_TOKEN="YourTokenMintAddressHere"
export TEST_TOKEN_SYMBOL="YTT"
export TEST_TOKEN_DECIMALS="9"
export TEST_TOKEN_NAME="YourTestToken"
```

2. **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Ÿè¡Œ**:
```bash
cd 400_test/200_automation
npm install
node setup.js
```

3. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**:
```bash
# ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã§ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ
npm run test:comprehensive

# ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ã§ã®å®Ÿé…å¸ƒ
npm run test:real-distribution

# å®Ÿé…å¸ƒã‚’å«ã‚€å…¨ãƒ†ã‚¹ãƒˆ
npm run test:all
```

### æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šã®ç¢ºèª
echo "Token: $CUSTOM_TEST_TOKEN"
echo "Symbol: $TEST_TOKEN_SYMBOL"
echo "Decimals: $TEST_TOKEN_DECIMALS"

# ãƒˆãƒ¼ã‚¯ãƒ³æ®‹é«˜ãƒã‚§ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
tributary collect --token "$CUSTOM_TEST_TOKEN" --threshold 0.1 --network testnet --dry-run
```

## ğŸ“‹ åˆ©ç‚¹ã®è¦ç´„

| å´é¢ | testnet SOL | ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ |
|------|-------------|-----------------|
| **å¯ç”¨æ€§** | âŒ é™å®š/ä¿¡é ¼æ€§ãªã— | âœ… å¸¸æ™‚åˆ©ç”¨å¯èƒ½ |
| **ä¾›çµ¦é‡** | âŒ 8æ™‚é–“ã‚ãŸã‚Š5 SOL | âœ… ç„¡åˆ¶é™ |
| **åˆ¶å¾¡** | âŒ å¤–éƒ¨ä¾å­˜ | âœ… å®Œå…¨åˆ¶å¾¡ |
| **ãƒ†ã‚¹ãƒˆç¯„å›²** | âŒ éå¸¸ã«é™å®šçš„ | âœ… åŒ…æ‹¬çš„ |
| **ä¿¡é ¼æ€§** | âŒ äºˆæ¸¬ä¸å¯èƒ½ | âœ… ä¸€è²«æ€§ |
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚é–“** | âŒ æ•°æ—¥/æ•°é€±é–“ | âœ… æ•°åˆ† |
| **ã‚³ã‚¹ãƒˆ** | âŒ æ™‚é–“ã‚³ã‚¹ãƒˆé«˜ | âœ… ã‚¼ãƒ­ã‚³ã‚¹ãƒˆ |

## ğŸ¯ çµè«–

ã‚«ã‚¹ã‚¿ãƒ SPLãƒˆãƒ¼ã‚¯ãƒ³ã®ä½¿ç”¨ã¯å˜ãªã‚‹å›é¿ç­–ã§ã¯ãªãã€ä»¥ä¸‹ã‚’æä¾›ã™ã‚‹**å„ªã‚ŒãŸãƒ†ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**ã§ã™ï¼š

- **ç„¡åˆ¶é™ã®ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**
- **ä¿¡é ¼æ€§ãŒã‚ã‚Šä¸€è²«ã—ãŸçµæœ**
- **ãƒ†ã‚¹ãƒˆæ¡ä»¶ã®å®Œå…¨åˆ¶å¾¡**
- **å¤–éƒ¨ãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆã¸ã®ä¾å­˜ã‚¼ãƒ­**
- **ç¾å®Ÿçš„ãªSPLãƒˆãƒ¼ã‚¯ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€é™å®šçš„ã§ä¿¡é ¼æ€§ã®ä½ã„testnet SOLãƒ•ã‚©ãƒ¼ã‚»ãƒƒãƒˆã§ã¯ä¸å¯èƒ½ãªåŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

è‹±èªç‰ˆã«ã¤ã„ã¦ã¯ã€[Custom_Token_Setup.md](./CUSTOM_TOKEN_SETUP.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚